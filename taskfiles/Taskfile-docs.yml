version: '3'

tasks:

  # `task docs` is equivalent to `task docs:serve`
  # intentionally not using a desc:, instead the serve: task has the description and indicates it is the default task
  default:
    cmds:
      - task: build
      - task: serve
    silent: true

  # === Documentation ===

  generate-tests:
    desc: Generate test documentation table from test docstrings
    summary: Extracts test info and creates docs/tests.md
    cmds:
      - echo "ğŸ“ Generating test documentation..."
      - |
        if [ ! -f scripts/generate_test_docs.py ]; then
          echo "WARNING: scripts/generate_test_docs.py not found, skipping test documentation generation"
          exit 0
        fi
        python3 scripts/generate_test_docs.py
    silent: true

  build:
    desc: Build documentation with MkDocs
    summary: Generates static documentation site in site/ directory
    deps:
      - generate-tests
    cmds:
      - echo "ğŸ“š Building documentation..."
      - |
        set -o pipefail
        uv run mkdocs build --strict {{.CLI_ARGS}}
      - echo "âœ… Documentation built successfully in site/"
    silent: true

  serve:
    desc: Serve documentation locally for development (default docs task)
    summary: Starts local server with live reload at http://127.0.0.1:8000
    cmds:
      - echo "ğŸŒ Starting documentation server..."
      - uv run mkdocs serve {{.CLI_ARGS}}
    silent: true

  clean:
    desc: Clean generated documentation files
    summary: Removes site/ directory and generated docs/tests.md
    cmds:
      - echo "ğŸ§¹ Cleaning documentation files..."
      - rm -rf site/
      - rm -f docs/tests.md
      - echo "âœ… Documentation files cleaned"
    silent: true

  watch:
    desc: Build and serve documentation with live reload
    summary: Combines build and serve for development workflow
    deps:
      - build
    cmds:
      - task: serve
    silent: true

